<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏ –æ–Ω–ª–∞–π–Ω</title>
<style>
  body { text-align:center; font-family:Arial; background:#f0f0f0; }
  h1 { margin-top:20px; }
  table { border-collapse: collapse; margin:50px auto; }
  td { border:2px solid #000; width:100px; height:100px; font-size:48px; text-align:center; cursor:pointer; }
  td.win { background: #90ee90; }
  button { margin-top:20px; padding:10px 20px; font-size:16px; cursor:pointer; }
</style>
</head>
<body>

<h1>–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏ –æ–Ω–ª–∞–π–Ω</h1>

<table id="board">
  <tr><td></td><td></td><td></td></tr>
  <tr><td></td><td></td><td></td></tr>
  <tr><td></td><td></td><td></td></tr>
</table>

<p>–•–æ–¥: <span id="turn">X</span></p>
<p id="result"></p>
<button id="reset">–ò–≥—Ä–∞—Ç—å –µ—â—ë</button>

<script type="module">
// –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Firebase
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.2.0/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.2.0/firebase-database.js";

// üîπ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–≤–æ–µ–≥–æ Firebase –ø—Ä–æ–µ–∫—Ç–∞
const firebaseConfig = {
  apiKey: "AIzaSyCHGyVydYRtpgCPeT-Ja_7YU4H-a0z_k0I",
  authDomain: "werrr-f91c8.firebaseapp.com",
  databaseURL: "https://werrr-f91c8-default-rtdb.firebaseio.com", // –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è Realtime Database
  projectId: "werrr-f91c8",
  storageBucket: "werrr-f91c8.appspot.com",
  messagingSenderId: "32501241615",
  appId: "1:32501241615:web:d09c098d13da7ea7a5107a"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const gameRef = ref(db, 'games/game1'); // —Å—Å—ã–ª–∫–∞ –Ω–∞ –∏–≥—Ä—É

// üîπ DOM —ç–ª–µ–º–µ–Ω—Ç—ã
const cells = document.querySelectorAll('td');
const turnDisplay = document.getElementById('turn');
const resultDisplay = document.getElementById('result');
const resetBtn = document.getElementById('reset');

// üîπ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã
function checkWinner(board){
  const combos = [
    [0,1,2],[3,4,5],[6,7,8],
    [0,3,6],[1,4,7],[2,5,8],
    [0,4,8],[2,4,6]
  ];
  for(let combo of combos){
    const [a,b,c] = combo;
    if(board[a] && board[a]===board[b] && board[a]===board[c]){
      return {winner: board[a], combo};
    }
  }
  return board.every(cell => cell) ? {winner:'draw'} : null;
}

// üîπ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤ Firebase
onValue(gameRef, snapshot => {
  const data = snapshot.val();
  if(!data) return;
  data.board.forEach((val,i)=> cells[i].textContent = val);
  turnDisplay.textContent = data.turn;
  if(data.winner){
    if(data.winner==='draw') resultDisplay.textContent = "–ù–∏—á—å—è!";
    else resultDisplay.textContent = "–ü–æ–±–µ–¥–∏–ª: " + data.winner;
    // –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –ª–∏–Ω–∏–∏
    if(data.combo) data.combo.forEach(i => cells[i].classList.add('win'));
    cells.forEach(c => c.style.pointerEvents='none');
  } else {
    cells.forEach(c => c.style.pointerEvents='auto');
    cells.forEach(c => c.classList.remove('win'));
    resultDisplay.textContent = '';
  }
});

// üîπ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –∫–ª–µ—Ç–∫–µ
cells.forEach((cell,index)=>{
  cell.addEventListener('click', ()=>{
    onValue(gameRef, snapshot=>{
      let data = snapshot.val();
      let board = data?.board || ["","","","","","","","",""];
      let turn = data?.turn || 'X';
      if(board[index] || data?.winner) return;
      board[index] = turn;
      const result = checkWinner(board);
      const winner = result ? result.winner : "";
      const combo = result?.combo || null;
      set(gameRef, {board, turn: turn==='X'?'O':'X', winner, combo});
    }, {once:true});
  });
});

// üîπ –ö–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞
resetBtn.addEventListener('click', ()=>{
  const board = ["","","","","","","","",""];
  set(gameRef, {board, turn:'X', winner:'', combo:null});
});
</script>

</body>
</html>
